(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[163],{3248:(e,r,s)=>{"use strict";s.d(r,{i:()=>a});var t=s(4725);let a={login:async(e,r)=>{try{let s=await t.A.post("/users/login",{email:e,password:r});if(s.data&&s.data.token)return s.data;throw Error("Login failed, no token received.")}catch(e){throw console.error("Login error:",e),e}},logout:async()=>{try{return(await t.A.post("/users/logout")).data}catch(e){throw console.error("Logout error:",e),e}},getAll:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;try{return(await t.A.get("/users",{params:{page:e,pageSize:r}})).data}catch(e){throw console.error("Error fetching all users:",e),e}},getById:async e=>{try{return(await t.A.get("/users/".concat(e))).data}catch(r){throw console.error("Error fetching user with id ".concat(e,":"),r),r}},createUser:async e=>{try{return(await t.A.post("/users",e)).data}catch(e){throw console.error("Error creating user:",e),e}},updateUser:async(e,r)=>{try{return(await t.A.put("/users/".concat(e),r)).data}catch(r){throw console.error("Error updating user with id ".concat(e,":"),r),r}},deleteUser:async e=>{try{return(await t.A.delete("/users/".concat(e))).data}catch(r){throw console.error("Error deleting user with id ".concat(e,":"),r),r}},filterUsers:async e=>{try{return(await t.A.post("/users/filter",e)).data}catch(e){throw console.error("Error filtering users:",e),e}}}},4725:(e,r,s)=>{"use strict";s.d(r,{A:()=>o});var t=s(3464),a=s(7948);let n=t.A.create({baseURL:"https://localhost:7295/api"});n.interceptors.request.use(e=>{let r=a.A.getState().token;return r&&(e.headers.Authorization="Bearer ".concat(r)),e},e=>Promise.reject(e)),n.interceptors.response.use(e=>e,e=>(e.response&&401===e.response.status?console.error("Unauthorized access - token may be expired."):e.response&&403===e.response.status&&console.error("Forbidden access."),Promise.reject(e)));let o=n},5215:(e,r,s)=>{"use strict";s.d(r,{A:()=>c});var t=s(5041),a=s(7948),n=s(3248),o=s(5695),i=s(6715),l=s(2115);let c=()=>{let{token:e,userId:r,userRole:s,setUser:c,clearUser:u}=(0,a.A)(),d=(0,o.useRouter)(),m=(0,i.jE)();(0,l.useEffect)(()=>{e&&r&&s||d.push("/")},[e,r,s,d]);let g=(0,t.n)({mutationFn:async e=>{let{email:r,password:s}=e,t=await n.i.login(r,s);c(t.token,t.user.userId,t.user.role);let a=await n.i.getById(t.user.userId);return a?(m.setQueryData(["user",t.user.userId],a),d.push("/dashboard")):console.error("User not found"),t},onError:e=>{alert("Login failed:",e),console.error("Login failed:",e)}}),h=(0,t.n)({mutationFn:async()=>{await n.i.logout(),u(),m.invalidateQueries(["user"])},onSuccess:()=>{console.log("Logged out successfully")},onError:e=>{console.error("Logout failed:",e)}});return{login:g.mutate,logout:h.mutate,loginLoading:g.isLoading,logoutLoading:h.isLoading,loginError:g.isError,logoutError:h.isError}}},6762:(e,r,s)=>{Promise.resolve().then(s.bind(s,9902))},7948:(e,r,s)=>{"use strict";s.d(r,{A:()=>n});var t=s(5453),a=s(6786);let n=(0,t.v)((0,a.Zr)(e=>({token:null,userId:null,userRole:null,setUser:(r,s,t)=>e({token:r,userId:s,userRole:t}),clearUser:()=>e({token:null,userId:null,userRole:null})}),{name:"auth-storage",getStorage:()=>localStorage}))},9902:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>U});var t=s(5155),a=s(2115),n=s(5695),o=s(7948),i=s(6874),l=s.n(i),c=s(7340),u=s(7434),d=s(5868),m=s(7580),g=s(741),h=s(1007),x=s(4783),f=s(4416),p=s(4835),y=s(5215),A=s(6715),j=s(9373),b=s(5041),w=s(3248);let E=()=>{let e=(0,A.jE)(),r=(0,j.I)({queryKey:["users"],queryFn:()=>w.i.getAll(),staleTime:3e5,cacheTime:6e5}),s=(0,b.n)({mutationFn:e=>w.i.createUser(e),onSuccess:()=>{e.invalidateQueries(["users"])},onError:e=>{console.error("Error creating user:",e)}}),t=(0,b.n)({mutationFn:e=>{let{id:r,userData:s}=e;return w.i.updateUser(r,s)},onSuccess:()=>{e.invalidateQueries(["users"]),e.invalidateQueries(["user"])},onError:e=>{console.error("Error updating user:",e)}}),a=(0,b.n)({mutationFn:e=>w.i.deleteUser(e),onSuccess:()=>{e.invalidateQueries(["users"])},onError:e=>{console.error("Error deleting user:",e)}}),n=(0,b.n)({mutationFn:e=>w.i.filterUsers(e),onSuccess:r=>{e.setQueryData(["users"],r)},onError:e=>{console.error("Error filtering users:",e)}});return{getAllUsers:r,getUserById:e=>(0,j.I)({queryKey:["user",e],queryFn:()=>w.i.getById(e),enabled:!!e}),createUser:s.mutate,updateUser:t.mutate,deleteUser:a.mutate,filterUsers:n.mutate,isCreatingUser:s.isLoading,isUpdatingUser:t.isLoading,isDeletingUser:a.isLoading,isFilteringUsers:n.isLoading}};function v(){let e=(0,n.usePathname)(),{token:r,userId:s,userRole:i}=(0,o.A)(e=>e),{logout:A}=(0,y.A)(),[j,b]=(0,a.useState)(!1),{data:w,isLoading:v}=E(s),U=[{href:"/dashboard",label:"Dashboard",icon:(0,t.jsx)(c.A,{size:20})},{href:"/readings",label:"Readings",icon:(0,t.jsx)(u.A,{size:20})},{href:"/billings_payment",label:"Billings & Payment",icon:(0,t.jsx)(d.A,{size:20})},{href:"/consumers",label:"Consumers",icon:(0,t.jsx)(m.A,{size:20})},{href:"/report",label:"Report",icon:(0,t.jsx)(g.A,{size:20})},..."Admin"===i?[{href:"/admin",label:"Admin",icon:(0,t.jsx)(m.A,{size:20})}]:[],{href:"/profile",label:"Profile",icon:(0,t.jsx)(h.A,{size:20})}];return((0,a.useEffect)(()=>{b(!1)},[e]),v)?(0,t.jsx)("div",{children:"Loading..."}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{className:"sm:hidden fixed top-2 right-2 z-50 bg-cyan-50 p-2 rounded shadow hover:bg-cyan-200",onClick:()=>b(!j),children:j?(0,t.jsx)(f.A,{className:"text-cyan-500",size:16}):(0,t.jsx)(x.A,{className:"text-cyan-500",size:16})}),(0,t.jsxs)("aside",{className:"bg-sky-200 text-sm text-gray-800 shadow-md h-screen flex flex-col items-center p-4\n                    transition-transform duration-300 z-40 fixed top-0 left-0\n                    ".concat(j?"translate-x-0":"-translate-x-full"," sm:translate-x-0 sm:w-64"),children:[(0,t.jsxs)("div",{className:"flex flex-col items-center mb-4",children:[(0,t.jsx)("img",{src:"/images/BLWSDAI_logo.png",alt:"Logo",className:"w-10 mb-2"}),(0,t.jsx)("p",{className:"font-bold",children:"BLWSDAI"})]}),(0,t.jsxs)("div",{className:"hidden sm:flex flex-col items-center text-center mb-6",children:[(0,t.jsx)("img",{src:"images/".concat(i||"Staff",".png"),alt:"User",className:"w-24 h-24 rounded-full mb-2"}),(0,t.jsx)("p",{className:"font-bold",children:(null==w?void 0:w.name)||"Admin Name"}),(0,t.jsx)("p",{className:"text-blue-600 text-sm capitalize",children:(null==w?void 0:w.role)||"Admin"})]}),(0,t.jsx)("div",{className:"mt-10 sm:mt-1",children:(0,t.jsx)("nav",{className:"w-full space-y-2 ",children:U.map(r=>{let{href:s,label:a,icon:n}=r;return(0,t.jsxs)(l(),{href:s,onClick:()=>b(!1),className:"flex items-center gap-3 px-10 sm:px-6 py-2 rounded-md transition \n                                    ".concat(e===s?"bg-blue-500 text-white":"hover:bg-blue-200 text-gray-800","\n                                "),children:[n,(0,t.jsx)("span",{className:"ml-2",children:a})]},s)})})}),(0,t.jsxs)("button",{onClick:A,className:"mt-auto flex items-center gap-2 text-red-600 hover:text-red-800 transition mt-6",children:[(0,t.jsx)(p.A,{size:20}),(0,t.jsx)("span",{children:"Logout"})]})]})]})}function U(e){let{children:r}=e,{token:s,userId:i,userRole:l,setUser:c,clearUser:u}=(0,o.A)(),d=(0,n.useRouter)(),m=(0,n.usePathname)(),[g,h]=(0,a.useState)(!0),[x,f]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{if(!x){f(!0),h(!1);return}s&&i||d.replace("/")},[s,i,d,m,x]),g||!x)?(0,t.jsx)("div",{children:"Loading..."}):(0,t.jsxs)("div",{className:"",children:[(0,t.jsx)(v,{}),"  ",(0,t.jsxs)("main",{className:"flex-1 ml-0 sm:ml-64 transition-all duration-300",children:[r,"   "]})]})}}},e=>{var r=r=>e(e.s=r);e.O(0,[246,373,253,441,684,358],()=>r(6762)),_N_E=e.O()}]);